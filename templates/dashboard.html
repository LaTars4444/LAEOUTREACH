{% extends "base.html" %}
{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="p-5 mb-4 bg-white rounded-3 shadow-sm">
            <h1>Welcome, {{ user.email }}</h1>
            <p>Status: <span class="badge bg-info text-dark">{{ user.subscription_status|upper }}</span></p>
            {% if user.subscription_end %}
                <p class="small text-muted">Access valid until: {{ user.subscription_end }}</p>
            {% endif %}
        </div>
    </div>
</div>

<div class="row">
    <!-- AI TOOL -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-dark text-white">Titan AI Generator</div>
            <div class="card-body">
                <textarea id="aiInput" class="form-control mb-2" placeholder="Describe the property or email scenario..."></textarea>
                <button onclick="runAI('email')" class="btn btn-outline-primary btn-sm">Generate Email</button>
                <button onclick="runAI('listing')" class="btn btn-outline-success btn-sm">Generate Listing</button>
                <div id="aiResult" class="mt-3 p-3 bg-light border rounded d-none"></div>
            </div>
        </div>
    </div>

    <!-- EMAIL MACHINE -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-danger text-white">Outreach Machine</div>
            <div class="card-body">
                <p>Status: {% if user.google_token %} <span class="text-success">Connected</span> {% else %} <span class="text-danger">Disconnected</span> {% endif %}</p>
                <!-- Simplified UI for demo -->
                <button class="btn btn-secondary" disabled>Connect Gmail (Config Required)</button>
            </div>
        </div>
    </div>
</div>

<script>
async function runAI(type) {
    const input = document.getElementById('aiInput').value;
    const resultBox = document.getElementById('aiResult');
    resultBox.classList.remove('d-none');
    resultBox.innerText = "Generating...";
    
    const res = await fetch('/ai/generate', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({type: type, input: input})
    });
    const data = await res.json();
    resultBox.innerText = data.result || data.error;
}
</script>
{% endblock %}
